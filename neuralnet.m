function [Y,Xf,Af] = neuralnet(X,~,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 08-May-2014 16:09:38.
% 
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 30xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 6xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-0.195224182106911;-0.250625267948645;-0.342807557790593;-0.350673464809474;-0.313829091546805;-0.361691179494972;-0.591566360140321;-0.754467947875178;-1.01153009670251;-1.36871530891091;-1.70005742699183;-1.97045051229794;-2.16896419564918;-2.32294869593053;-2.59003694684256;-2.8345122400467;-2.64199143991416;-2.54222819477531;-2.05183708654414;-2.15296463639346;-2.39320832197841;-2.56811723639215;-2.68476592517744;-2.85920561994372;-2.98364197741459;-3.03347834811686;-2.969452238107;-2.99194117620208;-3.43660389356418;-3.02806132876629];
  x1_step1_gain = [1.30300529308361;1.32571113842676;1.29424072481699;1.30428807035261;1.42654331752084;1.40235138982349;1.21057656300174;1.11280496799932;0.96718520364882;0.900912750742314;0.783910113817232;0.713951519871499;0.666705704802691;0.636937803524518;0.596396868868291;0.555872563998391;0.585119755914739;0.600650725922032;0.705921047940706;0.680109238474641;0.619459048460135;0.572638703952858;0.544657821438277;0.518635716720252;0.502862683333692;0.4901060924513;0.476682092675323;0.465676346622459;0.417776013509159;0.457901631207504];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [2.3141307549559218;-0.53188842141364479;1.0057326020601876;1.5009439758154886;-0.11346153803481938;1.0911190159864328;0.88136178908190532;-0.15224325374025524;0.61345918982390057;-1.888079917238277;-1.3862264847643857;1.205780871401734;-0.49293664285997452;0.56530268918599236;-1.5056387770103681];
  IW1_1 = [0.11822593451975918 0.14546920710563832 0.63278505031174792 0.53267615750759445 -0.11944393339649764 0.43222782074008775 0.33679898226064203 0.39289267136888428 0.46290203387295137 1.0822158882258543 1.1315267323420719 0.0049789279369494548 -0.80476577780896486 -1.1328815579320168 -1.2420580448367167 0.13441882809834321 -0.17993683572486877 0.64147785534432666 0.58111064172228022 0.6024498826367396 -0.74991652756969074 -1.0943107510603181 -1.4958910311500941 -0.65114024259691516 -0.49575076950423674 -0.30891492859351977 0.14525647151375731 0.99218042267145212 0.70701882006043859 -0.020635115714235958;0.62000900182642205 0.24746628273310961 -0.38045254726660815 0.0097559812411089422 -0.93284577949004666 0.14166711444766203 0.52777963216316393 -0.056257705264688755 -0.021149361035756296 0.6299203225571155 -0.25184117358030506 0.75158681437190189 0.73465412916338191 0.014425414630797233 0.89317525265802777 1.3681645253658072 1.5344818361497496 1.4562227485983572 0.8422245000363342 -0.084818139313579163 -0.77345305196242253 -1.2365926316500873 -1.6438235944812163 -1.1011206992483504 -0.64959955432468353 -0.1275024436083807 -0.081837689497933311 0.30621640101258563 1.0920033006839736 0.62927303490260911;-0.19634230150638363 -0.31887768990285342 -0.36100990358629165 0.29535246444607338 0.053770527857366635 -0.32888222070080492 0.63339783953183659 0.032912242703057211 0.52057883155274975 -0.33519582887742183 -0.25408373793792016 -0.59525145299436744 -0.25422102926666118 -0.2182335217322412 0.03385973496383414 -0.40505418579898794 -0.36882084289411016 -0.14545236658816008 0.37983023195941507 0.49011467681110077 -0.35174324742094021 0.42415951937790147 0.12419013869250949 -0.0067524277195774966 -0.25117010774260667 0.4068617220461519 0.44947874874740923 -0.46608109797372926 -0.21871218959109806 -0.2874001857154086;1.031416172276427 1.1114936171863057 -0.18623706445570906 -0.35957955810228592 -1.0907024755382126 -0.15323382059335627 0.27079678814070041 -0.28963214127273279 -0.51374334111890174 -0.5492779587850396 0.064705192163771963 -0.50219640369226182 -0.53913257499992695 -0.11128282167924647 -0.41306894827032042 0.20995024262355522 0.071401222349189025 0.17345623604014931 0.47261272575452068 0.069101158473929281 -0.7660946626972176 -0.8314512856384666 -1.2554033861876126 -1.44064909903978 -0.87132102673543099 -0.34602391609461691 -0.0077907277575034548 -0.0078223849495054551 1.0208664068759128 1.1458625842162378;1.6057825422402645 0.44906514441042711 -0.85662545504631993 -1.3275482902870774 -0.86909215464032841 -0.97715740650760541 0.23849035940847252 0.41168879901884131 0.37501284968355014 0.52302931838184175 1.0742080960382923 0.76806094802102154 0.031837749288064092 -0.13696631228983897 -0.0040686033903179989 0.25503534790005833 0.45863821311063557 0.81281099268929113 0.56226341085080778 0.087844186693067844 -0.39827893252531071 -0.51909672260459383 -0.92928747543576107 -1.3280072886950447 -1.3016064276587518 -1.2018377979009882 -0.39659258808335374 0.44127917981146486 0.6155979963451409 0.95356018990431513;-0.54155985287410691 -0.38936082762989577 -0.10500256863134899 -0.57190873396516484 -0.39878312586506676 -0.29065907246300271 -0.059668098527487966 -0.77441865143246336 -0.52878586832482066 -0.61445398295147835 -0.51063060504671054 -0.26012179053379653 -0.59083230428044597 -0.27069353113697847 -0.44101976327824804 -0.13115574518764456 0.035605227226845691 0.74793848983158606 0.80105661845425291 0.064477019182516179 0.15054162078404407 -0.20824205960751468 -1.0698732242822511 -0.51248262302817738 -0.56247986418563556 -0.5844755338180424 -0.11962149781735792 0.54216392674862868 0.11866905435043905 0.13591780381503824;-1.7926020193353398 -0.44423424989417853 -0.26998859179801904 0.80714759498119226 0.57703111044193844 0.55869575002718086 0.31230878867086298 0.098287238613950431 -0.43493910433711308 0.30639292749659824 0.59609277224075896 0.040962828202134226 -0.028821385883571141 0.074278077670317355 -0.29510457492994785 0.10264585049175888 -0.0051562362131497667 0.61121064327378349 -0.28448048957870525 -0.18020244836863841 0.2879565876143369 -0.18182036098419624 0.39224253612222176 -0.081066468513437948 -0.034299846404766139 0.49620575162549085 -0.30050321617437992 0.19611248533575523 -0.15478835821540704 -1.0452772903660803;-0.43188812932559001 -0.61887395325503491 -0.40045333852917725 -0.37270236521712485 -0.43616193833804012 -0.46831218037778477 -0.082387279746382686 -0.31138671188571365 0.23678860968583207 -0.53905763057803002 -0.37597130757302594 0.10717854995766873 -0.26118416646827464 0.35946379056513 0.15752062373471065 -0.07571617349835659 0.38900526861611584 0.16772396354650934 -0.56323591711564613 0.012962486492783545 0.017165895997909464 -0.33129638612163193 0.39590491573930509 0.44077209257162231 0.43377450414254537 -0.28587960644141425 0.28689851932970428 0.33019966313632737 0.69260465260552995 0.67930313704587331;-0.73868345545440117 -0.41860342867252071 -1.2348932038010743 -0.46396835500766226 -0.76260644978840786 -0.20651202923778922 1.1426947175181983 0.2503457604729053 0.042823264173192779 0.95871497467039724 0.31657739038466681 -0.57918959206026988 -0.74450225351951971 -0.45792163301851513 -0.39675614689910466 -1.148643696089201 -0.39235543422045366 -0.53952099995228386 0.87768231459518764 1.4629508583442854 0.99601513362717897 1.042783936232665 1.5269546717498246 0.93530384531720234 0.28407878466823222 0.66999098970064808 0.44516927296725128 -0.49296676839115733 -0.54780890569303886 -0.61897463972779243;0.8278907912996144 1.0098928751294909 0.52962680351992131 0.020442741172391067 0.76498553926236235 -0.44670511344884956 -0.57704834903859792 0.28705592307583661 0.11145736989788078 -0.33191623742222875 0.045675823479321351 0.52776381964306029 -0.17268582761525367 0.48277592593361401 0.38733602085932617 0.5438748312417393 0.5030980447415685 0.16587180473867222 0.05607219233658086 -0.42481447428169683 0.043234875386594485 -0.39496999762150931 -0.11245196928453652 -0.18497640870072726 0.56160150023985655 0.37592397117015169 0.64129766782338304 0.53478490806503864 0.46814337468002343 0.097604392459245098;-0.52981643237773179 -0.59713716484612134 0.51850999946595466 0.59265633584094946 1.3138439227679464 1.9561711490031837 1.0733684177181346 1.3017825059886199 -0.0099112403386049531 -0.5734801595545026 -0.55797115150106491 0.23346909096079443 0.45207518121381057 -0.28052691720528816 -0.020596645950024247 0.61960919969421657 -0.035125223698382328 0.02386137659811868 -0.072593757610868545 -0.83491320506352917 -0.99313315269774782 -0.34349164179775354 -0.89657378137200849 -0.34293601685024705 -0.036392553346542775 1.0220799056283081 0.29707636278999328 0.95296751232734089 0.78248543765673828 0.63072452769188414;0.058327850666282995 0.12684142664965284 0.30127081752333773 -0.29396848323201458 -0.13725665649422142 0.1800503082173866 -0.15266074132022714 0.24080695941340513 -0.12433812163062366 -0.24956560532082855 0.53639967325423565 -0.079213126204521186 -0.21446116315069719 -0.28796123276885344 0.11312500882081386 0.59830018483751968 -0.10382346661431979 -0.19632345921135333 -0.069687165156141651 -0.18146344511295587 0.0048887783820333779 0.088941754498677639 0.081830091043412712 0.32058112058909499 0.54531504260531882 0.31389017917588891 0.61821552561559912 0.43050395865098445 0.37185934652458513 0.65479475244803897;2.18327747171953 1.0257253422880348 0.71404280072308002 -0.34552947185095212 0.52254091805750691 -0.29747785341272731 0.49351227746447074 1.4514806693043756 0.89162519231660908 0.12145638891078472 -0.27498850271390513 -0.28065695038083166 0.082525959461280107 -0.24228637262453084 -0.15671567378431114 0.23000291498367365 0.3681590964951672 -0.019800245822298872 -0.86910240068311628 -0.57486427544381447 -0.43639746810046759 -0.89355419303873462 -0.25272188021644565 0.063052688341517144 -0.12015508444824299 0.18987140086289064 0.30961310570385403 0.20164802873343718 0.5164920557482725 0.79631197177911017;-0.14519390648783093 0.08209610776300573 -0.60657730575742297 -0.24940950421373673 0.95423297631481108 -0.21861379924186752 0.031496076223287602 -0.11048311110078769 0.57512313657268499 0.12996834135497504 0.13730532467686318 -0.69156583247818004 -0.86293220944874305 -0.65552212745765548 -1.0526249750553629 -1.001296893372521 -0.70601665361951849 -1.2331923290251285 -0.7100892361863762 -0.47498529294045339 -0.17840222579615325 0.23605915971872446 0.8532975545108622 0.98896049284448062 0.45438422040855297 0.78808847042846131 0.29697956886274474 0.1826572049485127 -0.64547111448476757 -0.051302395354514314;-0.18715387989394588 0.35508174579704049 0.32636723331654283 0.082812695536113701 0.27466226556460205 -0.20956188948620411 0.30401758875057106 0.21139551242524107 -0.36397741890175001 -0.36573367515557625 -0.38350177303840466 0.00046558159510780685 -0.24377358577181021 -0.062123407222819678 -0.58670709600092008 -0.29793695830313754 -0.33787966063594954 0.012611879258413266 0.30119724492233796 -0.080294585890482689 -0.033089036791361187 0.62847697345031339 0.67801274994004279 0.46295930282785519 -0.11101358664447583 -0.0047056615393548194 0.47384627150237546 -0.084819910749958205 -0.10439620323640478 0.66460046621390778];
  
  % Layer 2
  b2 = [-0.88164158683377902;-0.16795342104899802;1.2261535613251791;0.9409132105699809;0.64404423250590215;0.59151941919866702];
  LW2_1 = [0.12543662968394195 1.0905855739559269 -0.71795276843294598 1.0257687513916691 2.6393513179079302 0.041564669112893179 -0.51352361591142148 0.1684754786180401 0.28093614331301875 -1.6977185942082986 0.29258194261695836 0.5202117874121075 -1.4688771684890058 0.10765346314129601 -0.51680196759924779;1.2262583186423701 0.79065745864026449 0.16131993132791453 -0.39352561493825949 -2.07207526721557 0.56014612154103849 -0.074655914785380986 -1.4045787265894718 0.8176345407873995 -0.18179496873085396 -0.72565991837800969 0.60289266441623168 -0.44287644898071021 -1.270003314077742 -1.2901673685749215;0.52690824427422245 1.7901272962048027 -1.060732941418143 0.66930148641367437 0.74933751535141879 1.4663798987783498 -0.7206778127246054 0.48520052905618755 -3.0906092923213611 1.0056082365328756 2.0917395433998061 0.35085280420332304 0.69304336550015289 -1.3789304747509148 -1.1625356360597778;-3.0886185429207287 -1.0936222123085519 -0.16835972589389625 -2.5177920427297957 -0.8618058272172433 -1.7902568911931995 -0.15572321378626233 0.99369466800822526 2.1675238876876088 1.6749517156475258 0.94352038250945502 0.33895072066063342 1.187506564372161 0.25353167432899792 0.1342144496151671;0.9372158820081915 0.32423212533467982 -0.10122678125605575 1.401869533699317 2.1534012069986721 -0.38405714250919176 -1.0182426977860199 -0.68377347040445369 1.2700303539686901 0.82145792055725808 -1.1951302845652827 -0.27725281168917792 1.4478476260380617 -0.54861431835989949 0.82341013439521216;1.5820952808079167 -3.060080126461973 -0.56457702319640779 -2.0828630843616036 -0.97165642851131884 -0.012376745765031259 2.2939086105335895 -1.0253156515604807 0.21740900780199293 -1.2743986053447014 -1.0891543984146868 -1.5582265111445814 -1.2989184934597673 1.3876445318191661 -0.85207928797880506];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = softmax_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Competitive Soft Transfer Function
function a = softmax_apply(n)
  nmax = max(n,[],1);
  n = bsxfun(@minus,n,nmax);
  numer = exp(n);
  denom = sum(numer,1); 
  denom(denom == 0) = 1;
  a = bsxfun(@rdivide,numer,denom);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end
